<!doctype html>
<html lang="ms" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistem Penilaian SKPM PPD (268 Item) </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
@media print {
  body * {
    visibility: hidden !important;
  }

  #report-content, #report-content * {
    visibility: visible !important;
  }

  #report-content {
    position: absolute;
    left: 0;
    top: 0;
    width: 210mm;
    min-height: 297mm;
    padding: 20mm;
    background: white;
  }
}
    body { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    html, body, #app { height: 100%; width: 100%; }
    #app { overflow-y: auto; }
    .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); }
    .card-modern { box-shadow: 0 8px 32px rgba(0,0,0,0.12); transition: all 0.3s ease; }
    .card-modern:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }
    .standard-card { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 2px solid #dee2e6; transition: all 0.3s ease; }
    .standard-card:hover { border-color: #3b82f6; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.1); }
    .score-slider { appearance: none; width: 100%; height: 8px; border-radius: 4px; background: linear-gradient(90deg, #ef4444 0%, #f97316 25%, #eab308 50%, #84cc16 75%, #22c55e 100%); outline: none; }
    .score-slider::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; border-radius: 50%; background: white; border: 3px solid #3b82f6; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .score-slider::-moz-range-thumb { width: 24px; height: 24px; border-radius: 50%; background: white; border: 3px solid #3b82f6; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .score-display { display: inline-block; padding: 0.5rem 1rem; border-radius: 0.75rem; font-weight: 700; font-size: 1.125rem; }
    .score-1 { background: #fee2e2; color: #991b1b; }
    .score-2 { background: #fef08a; color: #713f12; }
    .score-3 { background: #bbf7d0; color: #065f46; }
    .score-4 { background: #86efac; color: #15803d; }
    .status-excellent { background: #d1fae5; color: #065f46; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; }
    .status-good { background: #dbeafe; color: #0c2d6b; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; }
    .status-fair { background: #fef3c7; color: #78350f; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; }
    .status-poor { background: #fee2e2; color: #7f1d1d; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; }
    .progress-bar { height: 10px; background: #e5e7eb; border-radius: 5px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6 0%, #1e40af 100%); transition: width 0.3s ease; }
    .table-modern th { background: #f3f4f6; font-weight: 700; color: #1f2937; border-bottom: 2px solid #e5e7eb; text-align: left; }
    .table-modern td { border-bottom: 1px solid #f3f4f6; }
    .table-modern tr:hover { background: #f9fafb; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-in { animation: slideIn 0.3s ease-out; }
    .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
    .item-row { display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; margin-bottom: 0.5rem; }
    .item-label { flex: 1; font-size: 0.875rem; font-weight: 500; color: #374151; }
    .item-score { display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0; }
.tab-btn{
  padding:8px 14px;
  border-radius:8px;
  font-weight:600;
  border:1px solid #d1d5db;
  background:white;
  cursor:pointer;
}
.tab-btn.active{
  background:#2563eb;
  color:white;
  border-color:#1d4ed8;
}

  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full gradient-bg">
   <header class="bg-white/10 backdrop-blur-md border-b border-white/20 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-2 sm:gap-3 md:gap-4 min-w-0">
       <img id="logo-ppd" class="w-12 sm:w-14 md:w-16 h-12 sm:h-14 md:h-16 object-contain bg-white rounded-xl p-1 shadow-lg flex-shrink-0">

       <div class="min-w-0">
        <h1 id="ppd-name" class="text-lg sm:text-xl md:text-2xl font-bold text-white truncate">SISTEM PENILAIAN SKPM@KUALITI SEKOLAH PPD KOTA MARUDU</h1>
        <p class="text-white/70 text-xs sm:text-sm truncate">268 Item Penilaian Komprehensif</p>
       </div>
      </div>
     </div>
    </div>
   </header>
   <main class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 md:py-8">
    <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 mb-6 sm:mb-8">
     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <div class="flex items-start justify-between mb-3">
       <div>
        <p class="text-gray-600 text-xs sm:text-sm font-medium">Jumlah Penilaian</p>
        <h3 id="total-assessments" class="text-2xl sm:text-4xl font-bold text-gray-900 mt-2">0</h3>
       </div>
       <div class="w-10 sm:w-12 h-10 sm:h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
        <svg class="w-5 sm:w-6 h-5 sm:h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg>
       </div>
      </div>
      <p class="text-gray-500 text-xs">Sekolah dinilai</p>
     </div>
     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <div class="flex items-start justify-between mb-3">
       <div>
        <p class="text-gray-600 text-xs sm:text-sm font-medium">Purata Skor</p>
        <h3 id="average-score" class="text-2xl sm:text-4xl font-bold text-gray-900 mt-2">0.00</h3>
       </div>
       <div class="w-10 sm:w-12 h-10 sm:h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
        <svg class="w-5 sm:w-6 h-5 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
        </svg>
       </div>
      </div>
      <p class="text-gray-500 text-xs">Daripada 4.00</p>
     </div>
     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <div class="flex items-start justify-between mb-3">
       <div>
        <p class="text-gray-600 text-xs sm:text-sm font-medium">Pencapaian Target</p>
        <h3 id="target-achievement" class="text-2xl sm:text-4xl font-bold text-gray-900 mt-2">0%</h3>
       </div>
       <div class="w-10 sm:w-12 h-10 sm:h-12 bg-amber-100 rounded-lg flex items-center justify-center flex-shrink-0">
        <svg class="w-5 sm:w-6 h-5 sm:h-6 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
      </div>
      <p class="text-gray-500 text-xs">Sekolah capai target</p>
     </div>
     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <div class="flex items-start justify-between mb-3">
       <div>
        <p class="text-gray-600 text-xs sm:text-sm font-medium">Status Keseluruhan</p>
        <h3 id="overall-status" class="text-xl sm:text-3xl font-bold text-gray-900 mt-2">-</h3>
       </div>
       <div class="w-10 sm:w-12 h-10 sm:h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
        <svg class="w-5 sm:w-6 h-5 sm:h-6 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m6 2a8 8 0 11-16 0 8 8 0 0116 0z" />
        </svg>
       </div>
      </div>
      <p class="text-gray-500 text-xs">Taraf kualiti keseluruhan</p>
     </div>
    </div>
    <div class="bg-white card-modern rounded-xl overflow-hidden mb-6 sm:mb-8">
     <div class="px-4 sm:px-6 py-3 sm:py-5 border-b border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3">
<button onclick="exportExcel()"
  class="bg-green-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium text-sm hover:bg-green-700 transition flex items-center gap-2">
  üì• Export Excel Semua Rekod
</button>

      <h2 class="text-base sm:text-lg font-bold text-gray-900">Rekod Penilaian</h2><button onclick="showAddModal()" class="bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg font-medium text-sm hover:bg-blue-700 transition flex items-center justify-center gap-2">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
       </svg> Penilaian Baru </button>
     </div>
     <div class="overflow-x-auto max-h-[420px] overflow-y-auto border-t">
  <table class="w-full text-sm table-modern table-fixed">

      <thead class="sticky top-0 bg-gray-100 z-10">
        <tr class="bg-gray-100 border-b-2 border-gray-300">
         <th class="text-left font-bold text-gray-700 py-3 px-4 w-40">Nama Sekolah</th>
         <th class="text-left font-bold text-gray-700 py-3 px-4 w-24 hidden sm:table-cell">Kod</th>
        <th class="w-16 px-2 py-3 text-center">S1</th>
<th class="w-16 px-2 py-3 text-center hidden md:table-cell">S2</th>
<th class="w-16 px-2 py-3 text-center hidden lg:table-cell">S3</th>
<th class="w-16 px-2 py-3 text-center">S4</th>
<th class="w-20 px-2 py-3 text-center">Skor</th>

         <th class="text-center font-bold text-gray-700 py-3 px-2 w-28 hidden sm:table-cell">Status</th>
         <th class="text-center font-bold text-gray-700 py-3 px-2 w-24">Aksi</th>
        </tr>
       </thead>
       <tbody id="assessments-table">
        <tr>
         <td colspan="9" class="text-center py-8 text-gray-500 text-sm">
          <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg><p class="font-medium">Tiada rekod penilaian</p></td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
<!-- Ranking Sekolah -->
<div class="bg-white card-modern rounded-xl p-4 sm:p-6 mb-6 sm:mb-8">
  <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-4">Ranking Sekolah Berdasarkan Skor Keseluruhan</h3>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div>
      <h4 class="font-semibold text-green-700 mb-3">üèÜ Top 5 Sekolah</h4>
      <div id="top-ranking" class="space-y-2 text-sm"></div>
    </div>

    <div>
      <h4 class="font-semibold text-red-700 mb-3">‚ö†Ô∏è Bottom 5 Sekolah</h4>
      <div id="bottom-ranking" class="space-y-2 text-sm"></div>
    </div>
  </div>
</div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8">


     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-4 sm:mb-6">Purata Skor Mengikut Standard</h3>
<div id="standard-mini-chart" class="flex gap-3 mb-6"></div>

      <div class="space-y-4 sm:space-y-5" id="standard-averages"></div>
     </div>
     <div class="bg-white card-modern rounded-xl p-4 sm:p-6">
      <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-4 sm:mb-6">Taburan Status Pencapaian</h3>
      <div class="space-y-3 sm:space-y-4" id="status-distribution">
       <div class="flex items-center gap-2 sm:gap-3 text-xs sm:text-sm">
        <div class="w-3 h-3 rounded-full bg-green-500 flex-shrink-0"></div><span class="text-gray-600">Cemerlang (‚â•3.5)</span> <span id="status-excellent-count" class="ml-auto font-bold text-gray-900">0</span>
       </div>
       <div class="flex items-center gap-2 sm:gap-3 text-xs sm:text-sm">
        <div class="w-3 h-3 rounded-full bg-blue-500 flex-shrink-0"></div><span class="text-gray-600">Baik (2.5-3.4)</span> <span id="status-good-count" class="ml-auto font-bold text-gray-900">0</span>
       </div>
       <div class="flex items-center gap-2 sm:gap-3 text-xs sm:text-sm">
        <div class="w-3 h-3 rounded-full bg-amber-500 flex-shrink-0"></div><span class="text-gray-600">Sederhana (1.5-2.4)</span> <span id="status-fair-count" class="ml-auto font-bold text-gray-900">0</span>
       </div>
       <div class="flex items-center gap-2 sm:gap-3 text-xs sm:text-sm">
        <div class="w-3 h-3 rounded-full bg-red-500 flex-shrink-0"></div><span class="text-gray-600">Lemah (&lt;1.5)</span> <span id="status-poor-count" class="ml-auto font-bold text-gray-900">0</span>
       </div>
      </div>
     </div>
    </div>
   </main>
   <div id="modal" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-3 sm:p-4 z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto animate-in">
     <div class="sticky top-0 bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
      <h2 id="modal-title" class="text-lg sm:text-xl font-bold text-gray-900">Penilaian SKPM Sekolah</h2><button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 p-1 hover:bg-gray-100 rounded transition flex-shrink-0">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <form id="assessment-form" class="p-4 sm:p-6 space-y-5 sm:space-y-6">
      <div class="border-b border-gray-200 pb-5 sm:pb-6">
       <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Maklumat Sekolah</h3>
       <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
        <div>
  <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">
    Nama Sekolah
  </label>
  <select id="form-school-name"
    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"></select>
</div>

<div>
  <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2">
    Kod Sekolah
  </label>
  <select id="form-school-code"
    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"></select>
</div>
        <div><label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Tarikh Penilaian</label> <input type="date" id="form-date" required class="w-full px-3 sm:px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
        </div>
        <div><label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Nama Penilai PPD</label> <input type="text" id="form-evaluator" required class="w-full px-3 sm:px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
        </div>
       </div>
      </div>
      <div class="border-b border-gray-200 pb-5 sm:pb-6">
       <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-4 sm:mb-5">Borang Penilaian SKPM (268 Item)</h3>
       <!-- TAB STANDARD DALAM MODAL -->
<div class="flex gap-2 mb-4">
  <button type="button" onclick="renderStandard(1)" class="tab-btn">Standard 1</button>
  <button type="button" onclick="renderStandard(2)" class="tab-btn">Standard 2</button>
  <button type="button" onclick="renderStandard(3)" class="tab-btn">Standard 3</button>
  <button type="button" onclick="renderStandard(4)" class="tab-btn">Standard 4</button>
</div>

<div id="standardContainer"></div>

      </div>
      <div class="bg-blue-50 rounded-lg p-4 sm:p-5 border border-blue-200 mb-5 sm:mb-6">
       <div class="flex items-center justify-between flex-col sm:flex-row gap-2">
        <div>
         <p class="text-xs sm:text-sm text-blue-700 font-medium">Skor Keseluruhan (Purata 4 Standard)</p>
         <p class="text-xs text-blue-600 mt-1">Dikira mengikut kaedah SKPM sebenar (Purata Aspek ‚Üí Kod ‚Üí Standard ‚Üí Keseluruhan)</p>
        </div><span id="overall-score-display" class="text-2xl sm:text-3xl font-bold text-blue-900 flex-shrink-0">2.0</span>
       </div>
      </div>
      <div class="border-t border-gray-200 pt-5 sm:pt-6">
       <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Catatan &amp; Tindakan Susulan</h3>
       <div class="mb-4"><label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Catatan Umum Penilaian</label> <textarea id="form-notes" rows="3" placeholder="Masukkan catatan umum atau pemerhatian penting..." class="w-full px-3 sm:px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-none"></textarea>
       </div>
       <div><label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Tindakan Susulan</label> <textarea id="form-action" rows="2" placeholder="Tindakan atau rekomendasi untuk peningkatan..." class="w-full px-3 sm:px-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-none"></textarea>
       </div>
      </div><input type="hidden" id="form-id">
      <div class="flex gap-2 sm:gap-3 pt-4 border-t border-gray-200"><button type="button" onclick="closeModal()" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg text-gray-900 font-medium text-sm hover:bg-gray-50 transition"> Batal </button> <button type="submit" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 text-white rounded-lg font-medium text-sm hover:bg-blue-700 transition"> Simpan </button>
      </div>
     </form>
    </div>
   </div>
   <div id="toast" class="fixed bottom-6 right-6 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50"><span id="toast-message"></span>
   </div>
   <div id="report-modal" class="fixed inset-0 modal-overlay hidden flex items-center justify-center p-3 sm:p-4 z-50">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] sm:max-h-[90vh] overflow-y-auto animate-in">
     <div class="sticky top-0 bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 flex items-center justify-between">
      <h2 id="report-modal-title" class="text-lg sm:text-xl font-bold text-gray-900">Laporan Penilaian SKPM</h2><button onclick="closeReportModal()" class="text-gray-500 hover:text-gray-700 p-1 hover:bg-gray-100 rounded transition flex-shrink-0">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div id="report-content" class="p-4 sm:p-6 overflow-y-auto max-h-[calc(95vh-120px)] sm:max-h-[calc(90vh-120px)]"></div>
   <div class="flex gap-2 sm:gap-3 p-4 sm:p-6 border-t border-gray-200 no-print">
  <button onclick="printReport()" class="w-full px-3 sm:px-4 py-2 sm:py-3 bg-blue-600 text-white rounded-lg font-medium text-sm hover:bg-blue-700 transition">
    üñ®Ô∏è Cetak Laporan
  </button>
  <button onclick="closeReportModal()" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg text-gray-900 font-medium text-sm hover:bg-gray-50 transition">
    Tutup
  </button>
</div>

     </div>
    </div>
   </div>
  </div>
  <script>
const API_URL = "https://script.google.com/macros/s/AKfycbyKI72XW_ynGm_2gp7WMAEWO6NbG5ckI1fVVZymGrAKLnZJRUa4W5Gx3TGxDeALmuJ6xA/exec";
const LOGO_PPD = "https://i.imgur.com/4EGUuTx.png";
const SCHOOL_LIST = [
["XBA5101","SEKOLAH KEBANGSAAN PEKAN KOTA MARUDU"],
["XBA5102","SEKOLAH KEBANGSAAN BENGKONGAN"],
["XBA5103","SEKOLAH KEBANGSAAN LANGKON"],
["XBA5104","SEKOLAH KEBANGSAAN MARAK-PARAK"],
["XBA5105","SEKOLAH KEBANGSAAN MASALOG"],
["XBA5106","SEKOLAH KEBANGSAAN POPOK"],
["XBA5107","SEKOLAH KEBANGSAAN SAMPIR"],
["XBA5108","SEKOLAH KEBANGSAAN SAMPARITA"],
["XBA5109","SEKOLAH KEBANGSAAN SIMPANGAN"],
["XBA5110","SEKOLAH KEBANGSAAN TAGAROH"],
["XBA5111","SEKOLAH KEBANGSAAN TANDEK"],
["XBA5112","SEKOLAH KEBANGSAAN TANJUNG BATU"],
["XBA5113","SEKOLAH KEBANGSAAN TARITIPAN"],
["XBA5114","SEKOLAH KEBANGSAAN TIGAMAN"],
["XBA5115","SEKOLAH KEBANGSAAN TIMBANG BATU"],
["XBA5116","SEKOLAH KEBANGSAAN SUNSUI"],
["XBA5117","SEKOLAH KEBANGSAAN ONGKILAN"],
["XBA5118","SEKOLAH KEBANGSAAN TEMUNO TERINGAI DARAT"],
["XBA5119","SEKOLAH KEBANGSAAN MELANGKAP"],
["XBA5120","SEKOLAH KEBANGSAAN TAGIBANG"],
["XBA5121","SEKOLAH KEBANGSAAN MANGARIS"],
["XBA5122","SEKOLAH KEBANGSAAN PANAITAN"],
["XBA5124","SEKOLAH KEBANGSAAN TUMUNDA SALIMANDUT"],
["XBA5125","SEKOLAH KEBANGSAAN TALANTANG"],
["XBA5126","SEKOLAH KEBANGSAAN MANGIN"],
["XBA5127","SEKOLAH KEBANGSAAN LAMPADA"],
["XBA5128","SEKOLAH KEBANGSAAN KOROMOKO"],
["XBA5129","SEKOLAH KEBANGSAAN GANA"],
["XBA5130","SEKOLAH KEBANGSAAN RANAU"],
["XBA5131","SEKOLAH KEBANGSAAN BINTASAN"],
["XBA5132","SEKOLAH KEBANGSAAN KOTA MARUDU II"],
["XBA5228","SEKOLAH KEBANGSAAN MAGANDAI"],
["XCC5122","SEKOLAH JENIS KEBANGSAAN (CINA) KHOI MING"],
["XEA5101","SEKOLAH MENENGAH KEBANGSAAN TANDEK"],
["XEA5102","SEKOLAH MENENGAH KEBANGSAAN BENGKONGAN"],
["XEA5103","SEKOLAH MENENGAH KEBANGSAAN BANDAU"],
["XEA5104","SEKOLAH MENENGAH KEBANGSAAN LANGKON"],
["XEA5105","SEKOLAH MENENGAH KEBANGSAAN KOTA MARUDU II"],
["XEA5106","SEKOLAH MENENGAH KEBANGSAAN TANDEK 2"],
["XEE5118","SEKOLAH MENENGAH KEBANGSAAN KOTA MARUDU"]
];


const config = {
  target_skor: 3.5
};
// ‚úÖ WAJIB ADA ‚Äî fungsi simpan ke Google Sheet
async function saveToSheet(data) {
  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(data),
  });
}
function printReport() {
  window.print();
}

async function loadFromSheet() {
  const res = await fetch(API_URL);
  const json = await res.json();
  const rows = json.data || json;

  allRecords = rows.map(r => {
    const clean = {};
    Object.keys(r).forEach(k => {
      clean[k.trim()] = r[k];
    });

    return {
      ...clean,
      __backendId: String(clean.__id ?? ""),
      __id: String(clean.__id ?? ""),
      skor_standard_1: parseFloat(clean.skor_standard_1) || 0,
      skor_standard_2: parseFloat(clean.skor_standard_2) || 0,
      skor_standard_3: parseFloat(clean.skor_standard_3) || 0,
      skor_standard_4: parseFloat(clean.skor_standard_4) || 0,
      skor_keseluruhan: parseFloat(clean.skor_keseluruhan) || 0,
      item_scores: clean.item_scores || "{}"
    };
  });

  updateDashboard(); // ‚úÖ WAJIB di luar map
}
    // SKPM Items Data (268 items dengan Aspek)
    const skpmItems = [
      // Standard 1: Kepemimpinan (44 items)
      { std: 1, kod: '1.1.1.PGB menetapkan hala tuju sekolah secara terancang', aspek: 'a', label: ' Membuat analisis SWOT / analisis lain yang bersesuaian' },
      { std: 1, kod: '1.1.1.PGB menetapkan hala tuju sekolah secara terancang', aspek: 'b', label: ' Menentukan sasaran / Petunjuk Prestasi Utama' },
      { std: 1, kod: '1.1.1.PGB menetapkan hala tuju sekolah secara terancang', aspek: 'c', label: ' Mendokumenkan hala tuju yang ditetapkan' },
      { std: 1, kod: '1.1.1.PGB menetapkan hala tuju sekolah secara terancang', aspek: 'd', label: ' Menyebarluaskan hala tuju yang ditetapkan' },
      { std: 1, kod: '1.1.2.PGB mengetuai penyediaan Rancangan Pemajuan Sekolah secara terancang dan sistematik', aspek: 'a', label: ' Menyediakan garis panduan/format perancangan strategik' },
      { std: 1, kod: '1.1.2.PGB mengetuai penyediaan Rancangan Pemajuan Sekolah secara terancang dan sistematik',aspek: 'b', label: ' Merangka strategi pencapaian sasaran' },
      { std: 1, kod: '1.1.2.PGB mengetuai penyediaan Rancangan Pemajuan Sekolah secara terancang dan sistematik',aspek: 'c', label: ' Memantau penyediaan perancangan strategik' },
      { std: 1, kod: '1.1.2.PGB mengetuai penyediaan Rancangan Pemajuan Sekolah secara terancang dan sistematik',aspek: 'd', label: ' Menyiapkan dokumen perancangan strategik' },
      { std: 1, kod: '1.1.3.PGB mengetuai pemantauan pengoperasian sekolah secara terancang dan sistematik', aspek: 'a', label: ' Melaksanakan pemantauan' },
      { std: 1, kod: '1.1.3.PGB mengetuai pemantauan pengoperasian sekolah secara terancang dan sistematik', aspek: 'b', label: ' Menyediakan rumusan pemantauan' },
      { std: 1, kod: '1.1.3.PGB mengetuai pemantauan pengoperasian sekolah secara terancang dan sistematik', aspek: 'c', label: ' Mengambil tindakan susulan' },
      { std: 1, kod: '1.1.4.PGB menerajui aktiviti instruksional dalam pelaksanaan pdp secara profesional dan terancang', aspek: 'a', label: ' Melaksanakan PdP' },
      { std: 1, kod: '1.1.4.PGB menerajui aktiviti instruksional dalam pelaksanaan pdp secara profesional dan terancang',  aspek: 'b', label: ' Menyediakan Rancangan Pelajaran Harian(RPH)' },
      { std: 1, kod: '1.1.4.PGB menerajui aktiviti instruksional dalam pelaksanaan pdp secara profesional dan terancang',  aspek: 'c', label: ' Melaksanakan peperiksaan/pentaksiran terhadap tahap penguasaan murid' },
      { std: 1, kod: '1.1.4.PGB menerajui aktiviti instruksional dalam pelaksanaan pdp secara profesional dan terancang',  aspek: 'd', label: ' Menyemak hasil kerja murid' },
      { std: 1, kod: '1.1.5.PGB menerajui aktiviti instruksional dalam pelaksanaan pencerapan pdp secara profesional dan terancang', aspek: 'a', label: ' Melaksanakan pencerapan PdP' },
      { std: 1, kod: '1.1.5.PGB menerajui aktiviti instruksional dalam pelaksanaan pencerapan pdp secara profesional dan terancang', aspek: 'b', label: ' Memberi maklum balas & bimbingan' },
      { std: 1, kod: '1.1.5.PGB menerajui aktiviti instruksional dalam pelaksanaan pencerapan pdp secara profesional dan terancang', aspek: 'c', label: ' Mengambil tindakan susulan' },
      { std: 1, kod: '1.1.6.PGB menerajui aktiviti instruksional dalam pelaksanaan pemantauan kemajuan dan pencapaian murid secara sistematik dan terancang', aspek: 'a', label: ' Menganalisis pencapaian murid' },
      { std: 1, kod: '1.1.6.PGB menerajui aktiviti instruksional dalam pelaksanaan pemantauan kemajuan dan pencapaian murid secara sistematik dan terancang', aspek: 'b', label: ' Menyediakan rumusan kemajuan dan pencapaian murid' },
      { std: 1, kod: '1.1.6.PGB menerajui aktiviti instruksional dalam pelaksanaan pemantauan kemajuan dan pencapaian murid secara sistematik dan terancang', aspek: 'c', label: ' Mengadakan dialog prestasi' },
      { std: 1, kod: '1.1.6.PGB menerajui aktiviti instruksional dalam pelaksanaan pemantauan kemajuan dan pencapaian murid secara sistematik dan terancang', aspek: 'd', label: ' Mengambil tindakan susulan' },
      { std: 1, kod: '1.1.7.PGB menangani masalah pengoperasian sekolah secara profesional dan terancang', aspek: 'a', label: ' Mengesan jangkaan masalah/isu' },
      { std: 1, kod: '1.1.7.PGB menangani masalah pengoperasian sekolah secara profesional dan terancang',  aspek: 'b', label: ' Mengenal pasti punca masalah/isu' },
      { std: 1, kod: '1.1.7.PGB menangani masalah pengoperasian sekolah secara profesional dan terancang',  aspek: 'c', label: ' Mengambil tindakan terhadap masalah/isu' },
      { std: 1, kod: '1.1.7.PGB menangani masalah pengoperasian sekolah secara profesional dan terancang',  aspek: 'd', label: ' Menyelesaikan masalah/isu' },
      { std: 1, kod: '1.1.7.PGB menangani masalah pengoperasian sekolah secara profesional dan terancang',  aspek: 'e', label: ' Mengambil langkah kawalan/tindakan pencegahan' },
      { std: 1, kod: '1.2.1.PGB memberi bimbingan kepada guru dan AKP secara profesional dan terancang', aspek: 'a', label: 'Memberi taklimat / bengkel / kursus / ceramah' },
      { std: 1, kod: '1.2.1.PGB memberi bimbingan kepada guru dan AKP secara profesional dan terancang', aspek: 'b', label: ' Memberi panduan / tunjuk ajar/tunjuk cara / nasihat/penerangan' },
      { std: 1, kod: '1.2.1.PGB memberi bimbingan kepada guru dan AKP secara profesional dan terancang', aspek: 'c', label: '1.2.1(c) Memberi maklum balas berkaitan prestasi kerja' },
      { std: 1, kod: '1.2.2.PGB memberi bimbingan kepada barisan pemimpin yang diturunkan kuasa secara profesional dan terancang', aspek: 'a', label: ' Memberi panduan / tunjuk ajar/tunjuk cara/nasihat/ penerangan' },
      { std: 1, kod: '1.2.2.PGB memberi bimbingan kepada barisan pemimpin yang diturunkan kuasa secara profesional dan terancang', aspek: 'b', label: ' Memberi maklum balas berkaitan prestasi kerja' },
      { std: 1, kod: '1.2.2.PGB memberi bimbingan kepada barisan pemimpin yang diturunkan kuasa secara profesional dan terancang', aspek: 'c', label: ' Memberi pendedahan berkaitan tugas kepimpinan' },
      { std: 1, kod: '1.3.1.PGB mendorong warga sekolah dengan menjadi suri teladan secara profesional dan terancang', aspek: 'a', label: ' Melaksanakan tugas berkualiti' },
      { std: 1, kod: '1.3.1.PGB mendorong warga sekolah dengan menjadi suri teladan secara profesional dan terancang',  aspek: 'b', label: ' Mempamerkan penampilan berwibawa' },
      { std: 1, kod: '1.3.1.PGB mendorong warga sekolah dengan menjadi suri teladan secara profesional dan terancang',  aspek: 'c', label: ' Bertindak sebagai pakar rujuk' },
      { std: 1, kod: '1.3.1.PGB mendorong warga sekolah dengan menjadi suri teladan secara profesional dan terancang',  aspek: 'd', label: ' Memperlihatkan komunikasi berkesan' },
      { std: 1, kod: '1.3.2.PGB menggalakan warga sekolah memberi input berkaitan pemajuan sekolah secara profesional dan terancang', aspek: 'a', label: ' Menyediakan saluran komunikasi' },
      { std: 1, kod: '1.3.2.PGB menggalakan warga sekolah memberi input berkaitan pemajuan sekolah secara profesional dan terancang', aspek: 'b', label: ' Mendengar pandangan pelbagai pihak' },
      { std: 1, kod: '1.3.2.PGB menggalakan warga sekolah memberi input berkaitan pemajuan sekolah secara profesional dan terancang', aspek: 'c', label: ' Menerima pandangan/maklum balas yang berbeza' },
      { std: 1, kod: '1.3.2.PGB menggalakan warga sekolah memberi input berkaitan pemajuan sekolah secara profesional dan terancang', aspek: 'd', label: ' Mengambil tindakan terhadap pandangan/maklum balas' },
      { std: 1, kod: '1.3.3.PGB menggerakkan warga sekolah dalam melaksanakan tanggungjawab secara terancang', aspek: 'a', label: ' Memberi maklum balas positif berkaitan prestasi/kemajuan/pencapaian kerja' },
      { std: 1, kod: '1.3.3.PGB menggerakkan warga sekolah dalam melaksanakan tanggungjawab secara terancang', aspek: 'b', label: ' Memberi penghargaan/pengiktirafan' },
      { std: 1, kod: '1.3.3.PGB menggerakkan warga sekolah dalam melaksanakan tanggungjawab secara terancang', aspek: 'c', label: 'Menyediakan keperluan & kemudahan' },
      { std: 1, kod: '1.3.3.PGB menggerakkan warga sekolah dalam melaksanakan tanggungjawab secara terancang', aspek: 'd', label: ' Melibatkan diri dalam aktiviti' },
      // Standard 2: Pengurusan Organisasi (38 items)
      { std: 2, kod: '2.1.1.Sumber manusia diurus secara sistematik dan terancang', aspek: 'a', label: ' Mengagihkan tugas' },
      { std: 2, kod: '2.1.1.Sumber manusia diurus secara sistematik dan terancang', aspek: 'b', label: ' Menyediakan perincian tugas' },
      { std: 2, kod: '2.1.1.Sumber manusia diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyebarluaskan perincian tugas' },
      { std: 2, kod: '2.1.1.Sumber manusia diurus secara sistematik dan terancang', aspek: 'd', label: ' Menilai prestasi kerja' },
      { std: 2, kod: '2.1.1.Sumber manusia diurus secara sistematik dan terancang', aspek: 'e', label: ' Melaksanakan urusan perkhidmatan(SPP/ePROPER)' },
      { std: 2, kod: '2.1.2.Pembangunan sumber manusia diurus secara terancang', aspek: 'a', label: ' Merancang program pembangunan profesionalsme' },
      { std: 2, kod: '2.1.2.Pembangunan sumber manusia diurus secara terancang', aspek: 'b', label: ' Melaksanakan program pembangunan profesionalsme' },
      { std: 2, kod: '2.1.2.Pembangunan sumber manusia diurus secara terancang', aspek: 'c', label: ' Menilai keberkesanan Program' },
      { std: 2, kod: '2.1.2.Pembangunan sumber manusia diurus secara terancang', aspek: 'd', label: ' Mengambil Tindakan susulan' },
      { std: 2, kod: '2.2.1.Aset alih dan aset tak alih diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyediakan harta modal dan aset alih bernilai rendah' },
      { std: 2, kod: '2.2.1.Aset alih dan aset tak alih diurus secara sistematik dan terancang', aspek: 'b', label: ' Menggunakan harta modal,aset alih bernilai rendah dan infrastruktur' },
      { std: 2, kod: '2.2.1.Aset alih dan aset tak alih diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyelenggara harta modal dan infrastruktur' },
      { std: 2, kod: '2.2.1.Aset alih dan aset tak alih diurus secara sistematik dan terancang', aspek: 'd', label: ' Mengambil Tindakan terhadap hasil pemeriksaan harta modal' },
      { std: 2, kod: '2.2.1.Aset alih dan aset tak alih diurus secara sistematik dan terancang', aspek: 'e', label: ' Merekod perolehan penggunaan dan penyelengaraan' },
      { std: 2, kod: '2.3.1.Kewangan diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyediakan anggaran perbelanjaan' },
      { std: 2, kod: '2.3.1.Kewangan diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan perbelanjaan' },
      { std: 2, kod: '2.3.1.Kewangan diurus secara sistematik dan terancang', aspek: 'c', label: ' Melaksanakan pemantauan perbelanjaan' },
      { std: 2, kod: '2.3.1.Kewangan diurus secara sistematik dan terancang', aspek: 'd', label: ' Mengambil tindakan susulan' },
      { std: 2, kod: '2.4.1.Sumber pendidikan diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyediakan alat/bahan,bahan cetak/elektronik dan TMK' },
      { std: 2, kod: '2.4.1.Sumber pendidikan diurus secara sistematik dan terancang', aspek: 'b', label: ' Menyimpan dan menyusun atur alat/bahan' },
      { std: 2, kod: '2.4.1.Sumber pendidikan diurus secara sistematik dan terancang', aspek: 'c', label: ' Menggunakan alat/bahan,bahan cetak/elektronik dan TMK' },
      { std: 2, kod: '2.4.1.Sumber pendidikan diurus secara sistematik dan terancang', aspek: 'd', label: ' Melaksanakan penyeliaan penggunaan alat/bahan' },
      { std: 2, kod: '2.5.1.Pesekitaran fizikal diselenggara secara sistematik dan terancang', aspek: 'a', label: ' Membersihkan kawasan,bangunan dan kemudahan sekolah' },
      { std: 2, kod: '2.5.1.Pesekitaran fizikal diselenggara secara sistematik dan terancang', aspek: 'b', label: ' Menceriakan kawasan,bangunan dan kemudahan sekolah' },
      { std: 2, kod: '2.5.1.Pesekitaran fizikal diselenggara secara sistematik dan terancang', aspek: 'c', label: ' Memulihkan kawasan bangunan dan kemudahan sekolah' },
      { std: 2, kod: '2.5.1.Pesekitaran fizikal diselenggara secara sistematik dan terancang', aspek: 'd', label: ' Mewujudkan ciri-ciri keselamatan' },
      { std: 2, kod: '2.5.2.Suasana yang selesa dan harmoni diwujud dan dikekalkan secara sistematik dan terancang', aspek: 'a', label: ' Menguatkuasakan ketetapan/peraturan sekolah' },
      { std: 2, kod: '2.5.2.Suasana yang selesa dan harmoni diwujud dan dikekalkan secara sistematik dan terancang', aspek: 'b', label: ' Merancang program peningkatan keakraban' },
      { std: 2, kod: '2.5.2.Suasana yang selesa dan harmoni diwujud dan dikekalkan secara sistematik dan terancang', aspek: 'c', label: ' Melaksanankan program peningkatan keakraban' },
      { std: 2, kod: '2.6.1.Pemahaman dan penerimaan terhadap kepelbagaian masyarakat malaysia diurus secara terancang', aspek: 'a', label: ' Menyebarkan maklumat tentang kepelbagaian masyarakat Malaysia' },
      { std: 2, kod: '2.6.1.Pemahaman dan penerimaan terhadap kepelbagaian masyarakat malaysia diurus secara terancang', aspek: 'b', label: ' Merancang program berteraskan perpaduan/silang budaya' },
      { std: 2, kod: '2.6.1.Pemahaman dan penerimaan terhadap kepelbagaian masyarakat malaysia diurus secara terancang', aspek: 'c', label: ' Melaksanakan program berteraskan perpaduan/silang budaya' },
      { std: 2, kod: '2.6.1.Pemahaman dan penerimaan terhadap kepelbagaian masyarakat malaysia diurus secara terancang', aspek: 'd', label: ' Merancang program jaringan/jalinan berteraskan perpaduan' },
      { std: 2, kod: '2.6.1.Pemahaman dan penerimaan terhadap kepelbagaian masyarakat malaysia diurus secara terancang', aspek: 'e', label: ' Melaksanakan program jaringan/jalinan berteraskan perpaduan' },
      { std: 2, kod: '2.7.1.Permufakatan strategik diusahkan secara profesional dan terancang', aspek: 'a', label: ' Merancang program yang melibatkan ibu bapa/penjaga,komuniti' },
      { std: 2, kod: '2.7.1.Permufakatan strategik diusahkan secara profesional dan terancang', aspek: 'b', label: ' Melaksanakan program yang melibatkan ibu bapa/penjaga' },
      { std: 2, kod: '2.7.1.Permufakatan strategik diusahkan secara profesional dan terancang', aspek: 'c', label: ' Mendapatkan sumbangan sokongan/khidmat kepakaran' },
      { std: 2, kod: '2.7.1.Permufakatan strategik diusahkan secara profesional dan terancang', aspek: 'd', label: ' Mewujudkan rangkaian komuniti' },
      // Standard 3: Kurikulum, Kokurikulum & HEM (95 items - shortened for space)
      { std: 3, kod: '3.1.1.Pelaksanaan kurikulum diurus secara sistematik dan terancang', aspek: 'a', label: ' Membuat ketetapan' },
      { std: 3, kod: '3.1.1.Pelaksanaan kurikulum diurus secara sistematik dan terancang', aspek: 'b', label: ' Mendokumenkan ketetapan' },
      { std: 3, kod: '3.1.1.Pelaksanaan kurikulum diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyebarluaskan ketetapan' },
      { std: 3, kod: '3.1.1.Pelaksanaan kurikulum diurus secara sistematik dan terancang', aspek: 'd', label: ' Menyemak semula ketetapan' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'a', label: ' Memperoleh dokumen kurikulum' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'b', label: ' Menyelaras penyediaan RPT dan RPH' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'c', label: ' Menyelaras pentaksiran' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'd', label: ' Menyelaras tugasan murid' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'e', label: ' Menganalisis data dan maklumat pentaksiran' },
      { std: 3, kod: '3.1.2.Pelaksanaan mata pelajaran diurus secara profesional dan terancang', aspek: 'f', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.1.2(2).Program peningkatan kualiti pengajaran guru diurus secara terancang', aspek: 'a', label: ' Merancang program pembangunan profesionalisme yang berkaitan dengan mata pelajaran' },
      { std: 3, kod: '3.1.2(2).Program peningkatan kualiti pengajaran guru diurus secara terancang', aspek: 'b', label: ' Melaksanakan progam pembangunan profesionalisme yang berkaitan dengan mata pelajaran' },
      { std: 3, kod: '3.1.2(2).Program peningkatan kualiti pengajaran guru diurus secara terancang', aspek: 'c', label: ' Menilai keberkesanan program' },
      { std: 3, kod: '3.1.2(2).Program peningkatan kualiti pengajaran guru diurus secara terancang', aspek: 'd', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.1.2(3).Program peningkatan pencapaian murid diurus secara profesional dan terancang', aspek: 'a', label: ' Merancang program yang menjurus ke arah peningkatan ilmu dan kemahiran' },
      { std: 3, kod: '3.1.2(3).Program peningkatan pencapaian murid diurus secara profesional dan terancang', aspek: 'b', label: ' Melaksanakan program yang menjurus ke arah peningkatan ilmu dan kemahiran' },
      { std: 3, kod: '3.1.2(3).Program peningkatan pencapaian murid diurus secara profesional dan terancang', aspek: 'c', label: ' Menilai keberkesanan programn' },
      { std: 3, kod: '3.1.2(3).Program peningkatan pencapaian murid diurus secara profesional dan terancang', aspek: 'd', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.1.2(4).Bantuan geran per kapita mata pelajaran dimanafaatkan secara sistematik dan terancang', aspek: 'a', label: ' Merancang perbelanjaan' },
      { std: 3, kod: '3.1.2(4).Bantuan geran per kapita mata pelajaran dimanafaatkan secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan perbelanjaan' },
      { std: 3, kod: '3.1.2(4).Bantuan geran per kapita mata pelajaran dimanafaatkan secara sistematik dan terancang', aspek: 'c', label: ' Memanafaatkan sumber pendidikan' },
      { std: 3, kod: '3.1.2(4).Bantuan geran per kapita mata pelajaran dimanafaatkan secara sistematik dan terancang', aspek: 'd', label: ' Merekod penerimaan dan penggunaan sumber' },
      { std: 3, kod: '3.1.3.Masa pelaksanaan pdp diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyediakan jadual waktu induk,jadual waktu kelas,jadual waktu guru,jadual waktu guru ganti dan jadual penggunaan bilik khas' },
      { std: 3, kod: '3.1.3.Masa pelaksanaan pdp diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan pdp seperti yang dijadualkan' },
      { std: 3, kod: '3.1.3.Masa pelaksanaan pdp diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyusun semula jadual waktu' },
      { std: 3, kod: '3.1.3.Masa pelaksanaan pdp diurus secara sistematik dan terancang', aspek: 'd', label: ' Menyelaras program sekolah' },
      { std: 3, kod: '3.1.4.Peperiksaan dan pentaksiran diurus secara sistematik dan terancang', aspek: 'a', label: ' Merancang peperiksaan dan pentaksiran' },
      { std: 3, kod: '3.1.4.Peperiksaan dan pentaksiran diurus secara sistematik dan terancang', aspek: 'b', label: ' Menyelaras peperiksaan dan pentaksiran' },
      { std: 3, kod: '3.1.4.Peperiksaan dan pentaksiran diurus secara sistematik dan terancang', aspek: 'c', label: ' Melaksanakan peperiksaan dan pentaksiran' },
      { std: 3, kod: '3.1.4.Peperiksaan dan pentaksiran diurus secara sistematik dan terancang', aspek: 'd', label: ' Menganalisis data peperiksaan dan pentaksiran' },
      { std: 3, kod: '3.1.4.Peperiksaan dan pentaksiran diurus secara sistematik dan terancang', aspek: 'e', label: ' Mengambil tindakan susulan/intervensi' },
      { std: 3, kod: '3.2.1.Pelaksanaan kokurikulum diurus secara sistematik dan terancang', aspek: 'a', label: ' Membuat ketetapan' },
      { std: 3, kod: '3.2.1.Pelaksanaan kokurikulum diurus secara sistematik dan terancang', aspek: 'b', label: ' Mendokumenkan ketetapan' },
      { std: 3, kod: '3.2.1.Pelaksanaan kokurikulum diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyebarluaskan ketetapan' },
      { std: 3, kod: '3.2.1.Pelaksanaan kokurikulum diurus secara sistematik dan terancang', aspek: 'd', label: ' Menyemak semula ketetapan' },
      { std: 3, kod: '3.2.2.Kelab/persatuan diurus secara sistematik dan terancang', aspek: 'a', label: ' Merancang aktiviti beteraskan ilmu pengetahuan,kemahiran dan kreativiti/inovasi' },
      { std: 3, kod: '3.2.2.Kelab/persatuan diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan aktiviti yang dirancang' },
      { std: 3, kod: '3.2.2.Kelab/persatuan diurus secara sistematik dan terancang', aspek: 'c', label: ' Merekodkan data dan maklumat' },
      { std: 3, kod: '3.2.2.Kelab/persatuan diurus secara sistematik dan terancang', aspek: 'd', label: ' Menganalisis data dan maklumat' },
      { std: 3, kod: '3.2.2.Kelab/persatuan diurus secara sistematik dan terancang', aspek: 'e', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.2.3.Badan beruniform diurus secara sistematik dan terancang', aspek: 'a', label: ' Merancang aktiviti beteraskan ilmu pengetahuan,kemahiran dan kreativiti/inovasi' },
      { std: 3, kod: '3.2.3.Badan beruniform diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan aktiviti yang dirancang' },
      { std: 3, kod: '3.2.3.Badan beruniform diurus secara sistematik dan terancang', aspek: 'c', label: ' Merekod data dan maklumat' },
      { std: 3, kod: '3.2.3.Badan beruniform diurus secara sistematik dan terancang', aspek: 'd', label: ' Menganalisis data dan maklumat' },
      { std: 3, kod: '3.2.3.Badan beruniform diurus secara sistematik dan terancang', aspek: 'e', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.2.4.Sukan/permainan diurus secara sistematik dan terancang', aspek: 'a', label: ' Merancang aktiviti berteraskan ilmu pengetahuan,kemahiran dan kreativiti/inovasi' },
      { std: 3, kod: '3.2.4.Sukan/permainan diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan aktiviti yang dirancang' },
      { std: 3, kod: '3.2.4.Sukan/permainan diurus secara sistematik dan terancang', aspek: 'c', label: ' Merekodkan data dan maklumat' },
      { std: 3, kod: '3.2.4.Sukan/permainan diurus secara sistematik dan terancang', aspek: 'd', label: ' Menganalisis data dan maklumat' },
      { std: 3, kod: '3.2.4.Sukan/permainan diurus secara sistematik dan terancang', aspek: 'e', label: ' Mengambil tindakan susulan' },
      { std: 3, kod: '3.2.5.Program kecemerlangan kokurikulum diurus secara profesional dan terancang', aspek: 'a', label: ' Merancang latihan peningkatan kemahiran' },
      { std: 3, kod: '3.2.5.Program kecemerlangan kokurikulum diurus secara profesional dan terancang', aspek: 'b', label: ' Melaksanakan latihan peningkatan kemahiran' },
      { std: 3, kod: '3.2.5.Program kecemerlangan kokurikulum diurus secara profesional dan terancang', aspek: 'c', label: ' Merancang program pemantapan' },
      { std: 3, kod: '3.2.5.Program kecemerlangan kokurikulum diurus secara profesional dan terancang', aspek: 'd', label: ' Melaksanakan program pemantapan' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'a', label: ' Merancang kejohanan merentas desa' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'b', label: ' Merancang sukan tara' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'c', label: ' Merancang kejohanan olahraga tahunan' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'd', label: ' Merancang pertandingan antara tingkatan' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'e', label: ' Melaksanakan kejohanan merentas desa' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'f', label: ' Melasanakan sukan tara' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'g', label: ' Melaksanakan kejohanan olahraga' },
      { std: 3, kod: '3.2.6.Aktiviti sukan untuk semua diurus secara profesional dan terancang', aspek: 'h', label: ' Melaksanakan pertandingan antara' },
      { std: 3, kod: '3.2.7.Pentaksiran kokurikulum dilaksanakan secara sistematik dan terancang', aspek: 'a', label: ' Merancang pentaksiran' },
      { std: 3, kod: '3.2.7.Pentaksiran kokurikulum dilaksanakan secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan pentaksiran' },
      { std: 3, kod: '3.2.7.Pentaksiran kokurikulum dilaksanakan secara sistematik dan terancang', aspek: 'c', label: ' Menganalisis data dan maklumat pentaksiran' },
      { std: 3, kod: '3.2.7.Pentaksiran kokurikulum dilaksanakan secara sistematik dan terancang', aspek: 'd', label: ' Mengambil tindakan susulan intervensi' },
      { std: 3, kod: '3.3.1.Perlaksanaan hal ehwal murid diurus secara sistematik dan terancang', aspek: 'a', label: ' Membuat ketetapan' },
      { std: 3, kod: '3.3.1.Perlaksanaan hal ehwal murid diurus secara sistematik dan terancang', aspek: 'b', label: ' Mendokumenkan ketetapan' },
      { std: 3, kod: '3.3.1.Perlaksanaan hal ehwal murid diurus secara sistematik dan terancang', aspek: 'c', label: ' Menyebarluaskan ketetapan' },
      { std: 3, kod: '3.3.1.Perlaksanaan hal ehwal murid diurus secara sistematik dan terancang', aspek: 'd', label: ' Menyemak semula ketetapan' },
      { std: 3, kod: '3.3.2.Displin murid diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyebarluaskan peraturan sekolah' },
      { std: 3, kod: '3.3.2.Displin murid diurus secara sistematik dan terancang', aspek: 'b', label: ' Menguatkuasakan peraturan sekolah' },
      { std: 3, kod: '3.3.2.Displin murid diurus secara sistematik dan terancang', aspek: 'c', label: ' Menganalisis data displin' },
      { std: 3, kod: '3.3.2.Displin murid diurus secara sistematik dan terancang', aspek: 'd', label: ' Merancang program pendidikan displin' },
      { std: 3, kod: '3.3.2.Displin murid diurus secara sistematik dan terancang', aspek: 'e', label: ' Melaksanakan program pendidikan displin' },
      { std: 3, kod: '3.3.3.Keselamatan murid diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyebarluaskan peraturan dan prosedur operasi standard keselamatan' },
      { std: 3, kod: '3.3.3.Keselamatan murid diurus secara sistematik dan terancang', aspek: 'b', label: ' Menguatkuasakan peraturan dan prosedur operasi standard keselamatan' },
      { std: 3, kod: '3.3.3.Keselamatan murid diurus secara sistematik dan terancang', aspek: 'c', label: ' Merancang program pencegahan dan kesedaran keselamatan' },
      { std: 3, kod: '3.3.3.Keselamatan murid diurus secara sistematik dan terancang', aspek: 'd', label: ' Melaksanakanprogram pencegahan dan kesedaran keselamatan' },
      { std: 3, kod: '3.3.4.Program dan perkhidmatan kesihatan murid diurus secara sistematik dan terancang', aspek: 'a', label: ' Menyelaras pemeriksaan kesihatan/rawatan/imunisasi' },
      { std: 3, kod: '3.3.4.Program dan perkhidmatan kesihatan murid diurus secara sistematik dan terancang', aspek: 'b', label: ' Merancang program pencegahan dan kesedaran kesihatan' },
      { std: 3, kod: '3.3.4.Program dan perkhidmatan kesihatan murid diurus secara sistematik dan terancang', aspek: 'c', label: ' Melaksanakan program pencegahan dan kesedaran kesihatan' },
      { std: 3, kod: '3.3.4.Program dan perkhidmatan kesihatan murid diurus secara sistematik dan terancang', aspek: 'd', label: ' Mewujudkan pesekitaran yang bermaklumat tentang kesihatan' },
      { std: 3, kod: '3.3.5.Bantuan pelajaran murid diurus secara sistematik dan terancang', aspek: 'a', label: ' Mengenal pasti jenis bantuan' },
      { std: 3, kod: '3.3.5.Bantuan pelajaran murid diurus secara sistematik dan terancang', aspek: 'b', label: ' Mengenal pasti murid yang layak' },
      { std: 3, kod: '3.3.5.Bantuan pelajaran murid diurus secara sistematik dan terancang', aspek: 'c', label: ' Merekodkan maklumat murid yang menerima bantuan' },
      { std: 3, kod: '3.3.5.Bantuan pelajaran murid diurus secara sistematik dan terancang', aspek: 'd', label: ' Memantau restasi/kemajuan murid yang menerima bantuan' },
      { std: 3, kod: '3.3.6.Perkhidmatan bimbingan dan kaunseling diurus secara profesional dan terancang', aspek: 'a', label: ' Merancang sesi bimbingan/kaunseling' },
      { std: 3, kod: '3.3.6.Perkhidmatan bimbingan dan kaunseling diurus secara profesional dan terancang', aspek: 'b', label: ' Melaksanakan sesi bimbingan/kaunseling' },
      { std: 3, kod: '3.3.6.Perkhidmatan bimbingan dan kaunseling diurus secara profesional dan terancang', aspek: 'c', label: ' Merancang program bimbingan dan kaunseling' },
      { std: 3, kod: '3.3.6.Perkhidmatan bimbingan dan kaunseling diurus secara profesional dan terancang', aspek: 'd', label: ' Melaksanakan program bimbingan dan kaunseling' },
      { std: 3, kod: '3.3.7.Pentaksiran psikometrik diurus secara sistematik dan terancang', aspek: 'a', label: ' Merancang pentaksiran' },
      { std: 3, kod: '3.3.7.Pentaksiran psikometrik diurus secara sistematik dan terancang', aspek: 'b', label: ' Melaksanakan pentaksiran' },
      { std: 3, kod: '3.3.7.Pentaksiran psikometrik diurus secara sistematik dan terancang', aspek: 'c', label: ' Menganalisis data dan maklumat pentaksiran' },
      { std: 3, kod: '3.3.7.Pentaksiran psikometrik diurus secara sistematik dan terancang', aspek: 'd', label: ' Mengambil tindakan susulan/intervensi/konsultasi' },







      // Standard 4: Pembelajaran & Pemudahcaraan (38 items)
      { std: 4, kod: '4.1.1.Guru merancang pelaksanaan pdpc secara profesional  dan sistematik', aspek: 'a', label: ' Menyediakan RPH yang mengandungi objektif yang boleh diukur dan aktiviti pembelajaran yang sesuai' },
      { std: 4, kod: '4.1.1.Guru merancang pelaksanaan pdpc secara profesional  dan sistematik', aspek: 'b', label: ' Menentukan kaedah pentaksiran' },
      { std: 4, kod: '4.1.1.Guru merancang pelaksanaan pdpc secara profesional  dan sistematik', aspek: 'c', label: ' Menyediakan ABM/BBM/BBB/TMK' },
      { std: 4, kod: '4.2.1.Guru mengawal peroses pembelajaran secara profesional dan terancang', aspek: 'a', label: ' Mengelola isi pelajaran/skop pembelajaran yang dirancang' },
      { std: 4, kod: '4.2.1.Guru mengawal peroses pembelajaran secara profesional dan terancang', aspek: 'b', label: ' Mengelola masa pdpc selaras dengan aktiviti pembelajaran' },
      { std: 4, kod: '4.2.1.Guru mengawal peroses pembelajaran secara profesional dan terancang', aspek: 'c', label: ' Memberi peluang kepada penyertaan aktif murid' },
      { std: 4, kod: '4.2.2.Guru mengawal suasana pembelajaran secara profesional dan terancang', aspek: 'a', label: ' Mengawasi komunikasi murid dalam pdpc' },
      { std: 4, kod: '4.2.2.Guru mengawal suasana pembelajaran secara profesional dan terancang', aspek: 'b', label: ' Mengawasi perlakuan murid dalam pdpc' },
      { std: 4, kod: '4.2.2.Guru mengawal suasana pembelajaran secara profesional dan terancang', aspek: 'c', label: ' Menyusun atur kedudukan murid' },
      { std: 4, kod: '4.2.2.Guru mengawal suasana pembelajaran secara profesional dan terancang', aspek: 'd', label: ' Melaksanakan aktiviti pembelajaran yang menyeronokkan' },
      { std: 4, kod: '4.3.1.Guru membimbing murid secara profesional dan terancang', aspek: 'a', label: ' Memberi tunjuk ajar menguasai isi pelajaran' },
      { std: 4, kod: '4.3.1.Guru membimbing murid secara profesional dan terancang', aspek: 'b', label: ' Memberi tunjuk cara menguasai kemahiran' },
      { std: 4, kod: '4.3.1.Guru membimbing murid secara profesional dan terancang', aspek: 'c', label: ' Memandu murid membuat keputusan' },
      { std: 4, kod: '4.3.1.Guru membimbing murid secara profesional dan terancang', aspek: 'd', label: ' Memandu murid menggunakan sumber pendidikan' },
      { std: 4, kod: '4.3.1.Guru membimbing murid secara profesional dan terancang', aspek: 'e', label: ' Mengaitkan isi pelajaran dengan topik lain' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'a', label: ' Meransang murid berkomunikasi' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'b', label: ' Meransang murid berkolaboratif' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'c', label: ' Mengemukakan soalan pemikiran kritis' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'd', label: ' Mengajukan soalan membuat keputusan' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'e', label: ' Mewujudkan peluang untuk murid memimpin' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'f', label: ' Mengalakkan murid mengemukakan soalan' },
      { std: 4, kod: '4.4.1.Guru mendorong minda murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'g', label: ' Mengalakkan murid memperoleh pengetahuan' },
      { std: 4, kod: '4.4.2.Guru mendorong emosi murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'a', label: ' Memberi pujian terhadap pelakuan positif' },
      { std: 4, kod: '4.4.2.Guru mendorong emosi murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'b', label: ' Memberi penghargaan terhadap hasil kerja' },
      { std: 4, kod: '4.4.2.Guru mendorong emosi murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'c', label: ' Memberi keyakinan mengemukakan soalan' },
      { std: 4, kod: '4.4.2.Guru mendorong emosi murid dalam melaksanakan aktiviti pembelajaran secara profesional dan terancang', aspek: 'd', label: ' Prihatin terhadap keperluan murid' },
      { std: 4, kod: '4.5.1.Guru melaksanakan penilaian secara sistematik dan terancang', aspek: 'a', label: ' Menggunakan pelbagai kaedah pentaksiran' },
      { std: 4, kod: '4.5.1.Guru melaksanakan penilaian secara sistematik dan terancang', aspek: 'b', label: ' Menjalankan aktiviti pemulihan/pengayaan' },
      { std: 4, kod: '4.5.1.Guru melaksanakan penilaian secara sistematik dan terancang', aspek: 'c', label: ' Memberi latihan/tugasan berkaitan pelajaran' },
      { std: 4, kod: '4.5.1.Guru melaksanakan penilaian secara sistematik dan terancang', aspek: 'd', label: ' Membuat refleksi pdpc' },
      { std: 4, kod: '4.5.1.Guru melaksanakan penilaian secara sistematik dan terancang', aspek: 'e', label: ' Menyemak/menilai hasil kerja/latihan' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'a', label: ' Memberi respons berkaitan isi pelajaran' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'b', label: ' Berkomunikasi dalam melaksanakan aktiviti' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'c', label: ' Melaksanakan aktiviti pembelajaran kolaboratif' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'd', label: ' Memberi respons pemikiran kritis/kreatif' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'e', label: ' Mengemukakan soalan berkaitan isi pelajaran' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'f', label: ' Mengaitkan isi dengan kehidupan murid' },
      { std: 4, kod: '4.6.1.Murid melibatkan diri dalam proses pembelajaran secara berkesan', aspek: 'g', label: ' Membuat keputusan menyelesaikan masalah' }
    ];
// ===== LAZY RENDER ENGINE =====
const scoreStore = {};
function getKodOnly(fullKod){
  return fullKod.split('.').slice(0,3).join('.');
}

function renderStandard(stdNumber){
  const container = document.getElementById('standardContainer');
  const items = skpmItems.filter(i => i.std === stdNumber);

  // highlight tab
  document.querySelectorAll('.tab-btn').forEach((b,i)=>{
    b.classList.toggle('active', i === stdNumber-1);
  });

  // üî• KUMPUL ikut KOD ITEM (contoh 1.1.1)
 const grouped = {};
items.forEach(item=>{
  const kodOnly = getKodOnly(item.kod);
  if(!grouped[kodOnly]) grouped[kodOnly] = [];
  grouped[kodOnly].push(item);
});


  let html = '';

  Object.keys(grouped).forEach(kodOnly=>{
  const aspekItems = grouped[kodOnly];

  const tajuk = aspekItems[0].kod.substring(kodOnly.length + 1);


  html += `
    <div class="border-2 border-gray-200 rounded-lg mb-6 bg-gray-50">
      <div class="bg-gray-100 px-4 py-3">
        <div class="font-bold text-gray-800">Kod Item: ${kodOnly}</div>
        <div class="text-sm text-gray-700 mt-1">${tajuk}</div>
      </div>

        <div class="px-4 py-3 space-y-3">
    `;

    aspekItems.forEach(item=>{
 const kodOnly = getKodOnly(item.kod);
const fieldId = `item_${item.std}_${kodOnly}_${item.aspek}`.replace(/\./g,'_');


  const val = scoreStore[fieldId] ?? 2;

  html += `
    <div class="flex items-center justify-between gap-4 border-b pb-2">
      <div class="flex-1 text-sm font-medium text-gray-800">
        (${item.aspek}) ${item.label}
      </div>
      <div class="flex gap-2">
        ${[0,1,2,3,4].map(n=>`
          <button
            type="button"
            onclick="setScore('${fieldId}', ${n})"
            id="btn-${fieldId}-${n}"
            class="px-3 py-1 rounded font-bold border
            ${getScoreColor(val==n?n:-1)}">
            ${n}
          </button>
        `).join('')}
      </div>
    </div>
  `;
});


    html += `</div></div>`;
  });

  container.innerHTML = html;
  container.scrollTop = 0;
}


// üé® WARNA BUTANG
function getScoreColor(score){
  switch(score){
    case -1: return 'bg-white text-gray-700 border-gray-300'; // tak pilih
    case 0: return 'bg-gray-300 text-gray-800 border-gray-400'; // skor 0 dipilih
    case 1: return 'bg-red-500 text-white border-red-600';
    case 2: return 'bg-yellow-400 text-white border-yellow-500';
    case 3: return 'bg-green-400 text-white border-green-500';
    case 4: return 'bg-green-700 text-white border-green-800';
    default: return 'bg-white text-gray-700 border-gray-300';
  }
}


// üéØ SET SKOR
function setScore(fieldId, score){
  scoreStore[fieldId] = score;

  [0,1,2,3,4].forEach(n => {
    const btn = document.getElementById(`btn-${fieldId}-${n}`);
    if(btn){
      btn.className = 'px-3 py-1 rounded font-bold border ' +
        getScoreColor(n === score ? n : -1);
    }
  });

  updateOverallScore();
}

        let allRecords = [];
    let currentEditId = null;

    
   function initApp() {
  document.getElementById('logo-ppd').src = LOGO_PPD;
populateSchoolDropdowns();
  loadFromSheet();
    document.getElementById('assessment-form').addEventListener('submit', handleFormSubmit);
  document.getElementById('form-date').valueAsDate = new Date();
}


    // ‚úÖ KAEDAH SKPM SEBENAR: Purata Aspek ‚Üí Kod ‚Üí Standard ‚Üí Keseluruhan
   // ‚úÖ KAEDAH SKPM SEBENAR (LAZY RENDER VERSION)
// Purata Aspek ‚Üí Kod ‚Üí Standard ‚Üí Keseluruhan
function calculateSKPMScores(sourceScores) {

  // Step 1: Kumpul skor setiap aspek dari scoreStore
  const kodAverages = {};

  skpmItems.forEach(item => {
   const kodOnly = getKodOnly(item.kod);
const fieldId = `item_${item.std}_${kodOnly}_${item.aspek}`.replace(/\./g,'_');
const raw = sourceScores[fieldId];

const score = (raw === undefined || raw === null || raw === "") ? 2 : Number(raw);

    const kodKey = `${item.std}_${kodOnly}`;

    if (!kodAverages[kodKey]) kodAverages[kodKey] = [];
    kodAverages[kodKey].push(score);
  });

  // Step 2: Purata setiap KOD
  const kodAveragesCalculated = {};
  Object.keys(kodAverages).forEach(kodKey => {
    const scores = kodAverages[kodKey];
    kodAveragesCalculated[kodKey] =
      scores.reduce((a, b) => a + b, 0) / scores.length;
  });

  // Step 3: Purata setiap STANDARD
  const standardAverages = [0, 0, 0, 0, 0];

  for (let std = 1; std <= 4; std++) {
    const kodsForStandard = Object.keys(kodAveragesCalculated)
      .filter(k => k.startsWith(std + '_'));

    const kodScores = kodsForStandard.map(k => kodAveragesCalculated[k]);

    standardAverages[std] = kodScores.length > 0
      ? kodScores.reduce((a, b) => a + b, 0) / kodScores.length
      : 0;
  }

  // Step 4: Purata KESELURUHAN
  const overall =
    (standardAverages[1] +
     standardAverages[2] +
     standardAverages[3] +
     standardAverages[4]) / 4;

  return {
    standard1: standardAverages[1],
    standard2: standardAverages[2],
    standard3: standardAverages[3],
    standard4: standardAverages[4],
    overall: overall
  };
}
function populateSchoolDropdowns(){
  const nameSel = document.getElementById('form-school-name');
  const codeSel = document.getElementById('form-school-code');

  nameSel.innerHTML = `<option value="">Pilih Nama Sekolah</option>`;
  codeSel.innerHTML = `<option value="">Pilih Kod Sekolah</option>`;

  SCHOOL_LIST.forEach(([kod,nama])=>{
    nameSel.innerHTML += `<option value="${nama}" data-kod="${kod}">${nama}</option>`;
    codeSel.innerHTML += `<option value="${kod}" data-nama="${nama}">${kod}</option>`;
  });

  // pilih nama ‚Üí isi kod
  nameSel.addEventListener('change', ()=>{
    const kod = nameSel.selectedOptions[0].dataset.kod || '';
    codeSel.value = kod;
  });

  // pilih kod ‚Üí isi nama
  codeSel.addEventListener('change', ()=>{
    const nama = codeSel.selectedOptions[0].dataset.nama || '';
    nameSel.value = nama;
  });
}


    function updateOverallScore() {
   const scores = calculateSKPMScores(scoreStore);

      document.getElementById('overall-score-display').textContent = scores.overall.toFixed(2);
    }

    function updateDashboard() {
      const total = allRecords.length;
      document.getElementById('total-assessments').textContent = total;

      if (total === 0) {
        document.getElementById('average-score').textContent = '0.00';
        document.getElementById('overall-status').textContent = '-';
        document.getElementById('target-achievement').textContent = '0%';
        renderTable();
        updateStandardAverages();
        updateStatusDistribution();

        return;
      }

      const avgScore = allRecords.reduce((sum, r) => sum + (r.skor_keseluruhan || 0), 0) / total;
      const targetSkor = parseFloat(config.target_skor) || 3.5;
      const achieveTarget = allRecords.filter(r => (r.skor_keseluruhan || 0) >= targetSkor).length;
      const achievePercent = Math.round((achieveTarget / total) * 100);

      document.getElementById('average-score').textContent = avgScore.toFixed(2);
      document.getElementById('overall-status').textContent = getStatus(avgScore);
      document.getElementById('target-achievement').textContent = achievePercent + '%';

     renderTable();
updateStandardAverages();
updateStatusDistribution();
updateRanking();
updateStandardMiniChart();

    }

    function getStatus(score) {
      if (score >= 3.5) return 'Cemerlang';
      if (score >= 2.5) return 'Baik';
      if (score >= 1.5) return 'Sederhana';
      return 'Lemah';
    }

    function getStatusBadge(score) {
      if (score >= 3.5) return 'status-excellent';
      if (score >= 2.5) return 'status-good';
      if (score >= 1.5) return 'status-fair';
      return 'status-poor';
    }

    function renderTable() {
      const tbody = document.getElementById('assessments-table');
      
      if (allRecords.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" class="text-center py-8 text-gray-500 text-sm"><svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg><p class="font-medium">Tiada rekod penilaian</p></td></tr>';
        return;
      }

      tbody.innerHTML = allRecords.map(record => {
        const badgeClass = getStatusBadge(record.skor_keseluruhan);
        return `<tr class="border-b border-gray-200 hover:bg-gray-50">
          <td class="text-gray-900 py-3 px-4 w-40">${record.school_name}</td>
          <td class="text-gray-600 py-3 px-4 w-24 hidden sm:table-cell text-xs">${record.school_code || '-'}</td>
          <td class="text-center font-bold text-gray-900 py-3 px-2 w-16">${record.skor_standard_1.toFixed(1)}</td>
          <td class="text-center font-bold text-gray-900 py-3 px-2 w-16 hidden md:table-cell">${record.skor_standard_2.toFixed(1)}</td>
          <td class="text-center font-bold text-gray-900 py-3 px-2 w-16 hidden lg:table-cell">${record.skor_standard_3.toFixed(1)}</td>
          <td class="text-center font-bold text-gray-900 py-3 px-2 w-16">${record.skor_standard_4.toFixed(1)}</td>
          <td class="text-center font-bold text-blue-600 py-3 px-2 w-20">${record.skor_keseluruhan.toFixed(2)}</td>
          <td class="text-center py-3 px-2 w-28 hidden sm:table-cell"><span class="${badgeClass} text-xs">${getStatus(record.skor_keseluruhan)}</span></td>
          <td class="text-center py-3 px-2 w-24">
            <div class="flex gap-1 justify-center flex-wrap">
              <button onclick="viewSummary('${record.__backendId}')" class="text-green-600 hover:text-green-700 font-medium text-xs px-2 py-1 hover:bg-green-50 rounded">Rumusan</button>
              <button onclick="editRecord('${record.__backendId}')" class="text-blue-600 hover:text-blue-700 font-medium text-xs px-2 py-1 hover:bg-blue-50 rounded">Edit</button>
              <button onclick="deleteRecord('${record.__backendId}')" class="text-red-600 hover:text-red-700 font-medium text-xs px-2 py-1 hover:bg-red-50 rounded">Del</button>
            </div>
          </td>
        </tr>`;
      }).join('');
    }

    function updateStandardAverages() {

      const container = document.getElementById('standard-averages');
      const stdNames = ['Standard 1: Kepemimpinan', 'Standard 2: Pengurusan Organisasi', 'Standard 3: Kurikulum, Kokurikulum & HEM', 'Standard 4: Pembelajaran & Pemudahcaraan'];
      let html = '';
      for (let i = 1; i <= 4; i++) {
        const fieldName = `skor_standard_${i}`;
        const stdRecords = allRecords.filter(r => Number.isFinite(r[fieldName]));
        const avgScore = stdRecords.length > 0 ? stdRecords.reduce((sum, r) => sum + (r[fieldName] || 0), 0) / stdRecords.length : 0;
        const percent = (avgScore / 4) * 100;
        html += `<div><div class="flex items-center justify-between mb-2"><span class="text-sm font-medium text-gray-900">${stdNames[i-1]}</span><span class="text-sm font-bold text-gray-900">${avgScore.toFixed(2)}</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${percent}%"></div></div></div>`;
      }
      container.innerHTML = html;
    }

    function updateStatusDistribution() {
      const excellent = allRecords.filter(r => r.skor_keseluruhan >= 3.5).length;
      const good = allRecords.filter(r => r.skor_keseluruhan >= 2.5 && r.skor_keseluruhan < 3.5).length;
      const fair = allRecords.filter(r => r.skor_keseluruhan >= 1.5 && r.skor_keseluruhan < 2.5).length;
      const poor = allRecords.filter(r => r.skor_keseluruhan < 1.5).length;
      document.getElementById('status-excellent-count').textContent = excellent;
      document.getElementById('status-good-count').textContent = good;
      document.getElementById('status-fair-count').textContent = fair;
      document.getElementById('status-poor-count').textContent = poor;
    }
function updateRanking() {
  if (allRecords.length === 0) {
    document.getElementById('top-ranking').innerHTML = '';
    document.getElementById('bottom-ranking').innerHTML = '';
    return;
  }

  const sorted = [...allRecords].sort((a, b) => b.skor_keseluruhan - a.skor_keseluruhan);

  const top5 = sorted.slice(0, 5);
  const bottom5 = sorted.slice(-5).reverse();

  document.getElementById('top-ranking').innerHTML = top5.map((r, i) => `
    <div class="flex justify-between bg-green-50 border border-green-200 px-3 py-2 rounded">
      <span class="font-semibold">${i + 1}. ${r.school_name}</span>
      <span class="font-bold text-green-700">${r.skor_keseluruhan.toFixed(2)}</span>
    </div>
  `).join('');

  document.getElementById('bottom-ranking').innerHTML = bottom5.map((r, i) => `
    <div class="flex justify-between bg-red-50 border border-red-200 px-3 py-2 rounded">
      <span class="font-semibold">${i + 1}. ${r.school_name}</span>
      <span class="font-bold text-red-700">${r.skor_keseluruhan.toFixed(2)}</span>
    </div>
  `).join('');
}
function updateStandardMiniChart() {
  if (allRecords.length === 0) return;

  const stdAvg = [1,2,3,4].map(i => {
    const field = `skor_standard_${i}`;
    const records = allRecords.filter(r => Number.isFinite(r[field]));
    const avg = records.reduce((s, r) => s + r[field], 0) / records.length;
    return avg || 0;
  });

  const labels = ['S1', 'S2', 'S3', 'S4'];

  document.getElementById('standard-mini-chart').innerHTML = stdAvg.map((v, i) => `
    <div class="flex-1 text-center">
      <div class="bg-blue-100 rounded-t h-24 flex items-end justify-center">
        <div style="height:${(v/4)*100}%" class="w-8 bg-blue-600 rounded-t transition-all"></div>
      </div>
      <div class="text-xs font-semibold mt-2">${labels[i]}</div>
      <div class="text-xs text-gray-600">${v.toFixed(2)}</div>
    </div>
  `).join('');
}


    
   function showAddModal() {
  currentEditId = null;

  document.getElementById('modal-title').textContent = 'Penilaian SKPM Sekolah Baru';
  document.getElementById('modal').classList.remove('hidden');

  document.getElementById('form-school-name').value = '';
  document.getElementById('form-school-code').value = '';
  document.getElementById('form-evaluator').value = '';
  document.getElementById('form-notes').value = '';
  document.getElementById('form-action').value = '';
  document.getElementById('form-date').valueAsDate = new Date();

  // reset 268 skor
  skpmItems.forEach(item => {
   const kodOnly = getKodOnly(item.kod);
const id = `item_${item.std}_${kodOnly}_${item.aspek}`.replace(/\./g,'_');

    scoreStore[id] = 2;
  });

renderStandard(1);
setTimeout(updateOverallScore, 0);

}


   function editRecord(backendId) {
  const record = allRecords.find(r => r.__backendId === backendId);
  if (!record) return;

  currentEditId = backendId;

  document.getElementById('modal-title').textContent = 'Edit Penilaian SKPM';
  document.getElementById('form-school-name').value = record.school_name || '';
  document.getElementById('form-school-code').value = record.school_code || '';
  document.getElementById('form-date').value = record.tarikh_penilaian?.split('T')[0] || '';
  document.getElementById('form-evaluator').value = record.penilai_ppd || '';
  document.getElementById('form-notes').value = record.catatan_umum || '';
  document.getElementById('form-action').value = record.tindakan_susulan || '';

  // üî• WAJIB reset scoreStore dulu
  Object.keys(scoreStore).forEach(k => delete scoreStore[k]);

  let oldScores = {};
  try { oldScores = JSON.parse(record.item_scores || "{}"); } catch(e){}

  // üî• masukkan semua 268 skor ke memori
  skpmItems.forEach(item => {
    const kodOnly = getKodOnly(item.kod);
const id = `item_${item.std}_${kodOnly}_${item.aspek}`.replace(/\./g,'_');

  scoreStore[id] = Number(oldScores[id] ?? 2);

  });

 renderStandard(1);
setTimeout(updateOverallScore, 0);


  document.getElementById('modal').classList.remove('hidden');
}



    function closeModal() {
      document.getElementById('modal').classList.add('hidden');
      currentEditId = null;
         }

   async function handleFormSubmit(e) {
let oldScores = {};
if (currentEditId) {
  const oldRecord = allRecords.find(r => r.__backendId === currentEditId);
  try { oldScores = JSON.parse(oldRecord.item_scores || "{}"); } catch(e){}
}

  e.preventDefault();

  const schoolName = document.getElementById('form-school-name').value.trim();
  const evaluator = document.getElementById('form-evaluator').value.trim();
  const dateValue = document.getElementById('form-date').value;

  if (!schoolName || !evaluator || !dateValue) {
    showToast('Sila isi semua medan yang diperlukan.');
    return;
  }

  if (allRecords.length >= 999 && !currentEditId) {
    showToast('Had maksimum 999 rekod telah dicapai.');
    return;
  }

  try {
    // üî• WAJIB bina semua 268 skor
    const fullItemScores = {};
    skpmItems.forEach(item => {
     const kodOnly = getKodOnly(item.kod);
const fieldId = `item_${item.std}_${kodOnly}_${item.aspek}`.replace(/\./g,'_');

    if (scoreStore[fieldId] !== undefined) {
  fullItemScores[fieldId] = scoreStore[fieldId];
} else if (oldScores && oldScores[fieldId] !== undefined) {
  fullItemScores[fieldId] = oldScores[fieldId];
} else {
  fullItemScores[fieldId] = 2;
}




    });


    const scores = calculateSKPMScores(fullItemScores);


   const data = {
  __id: currentEditId || "",
  school_name: schoolName,
  school_code: document.getElementById('form-school-code').value.trim() || 'N/A',
  tarikh_penilaian: new Date(dateValue).toISOString(),
  penilai_ppd: evaluator,
  skor_standard_1: +scores.standard1.toFixed(2),
  skor_standard_2: +scores.standard2.toFixed(2),
  skor_standard_3: +scores.standard3.toFixed(2),
  skor_standard_4: +scores.standard4.toFixed(2),
  skor_keseluruhan: +scores.overall.toFixed(2),
  status: getStatus(scores.overall),
  catatan_umum: document.getElementById('form-notes').value.trim() || 'Tiada',
  tindakan_susulan: document.getElementById('form-action').value.trim() || 'Tiada',
  item_scores: JSON.stringify(fullItemScores)
};


    await saveToSheet(data);

    showToast(currentEditId ? 'Penilaian dikemaskini!' : 'Penilaian ditambah!');
    closeModal();
    await loadFromSheet();

  } catch (err) {
    console.error(err);
    showToast('Ralat semasa menyimpan data.');
  }
}

   async function deleteRecord(backendId) {
  if (!confirm('Padam rekod penilaian ini?')) return;

  await saveToSheet({
    __delete: true,
    __id: backendId
  });

  showToast('Penilaian dipadam.');
  loadFromSheet();
}

    function closeReportModal() {
      document.getElementById('report-modal').classList.add('hidden');
    }

    function viewSummary(backendId) {
      const record = allRecords.find(r => r.__backendId === backendId);
      if (!record) return;

      const statusBadge = getStatusBadge(record.skor_keseluruhan);
      const status = getStatus(record.skor_keseluruhan);
      const targetSkor = parseFloat(config.target_skor) || 3.5;
      const achieveTarget = record.skor_keseluruhan >= targetSkor;
      const tarikh = new Date(record.tarikh_penilaian).toLocaleDateString('ms-MY', { year: 'numeric', month: 'long', day: 'numeric' });

      const summaryHtml = `
        <div class="space-y-6 sm:space-y-8">
          <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-4 sm:p-6 border border-blue-100">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
              <div>
                <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold">Nama Sekolah</p>
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mt-1">${record.school_name}</h2>
                <p class="text-sm text-gray-600 mt-2">Kod: <span class="font-semibold">${record.school_code || '-'}</span></p>
              </div>
              <div>
                <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold">Maklumat Penilaian</p>
                <p class="text-sm text-gray-900 mt-1">Tarikh: <span class="font-semibold">${tarikh}</span></p>
                <p class="text-sm text-gray-900 mt-2">Penilai: <span class="font-semibold">${record.penilai_ppd || '-'}</span></p>
              </div>
            </div>
          </div>

          <div class="bg-white border-2 border-gray-200 rounded-lg p-4 sm:p-6">
            <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-4">Skor Keseluruhan</p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div class="flex items-center justify-center">
                <div class="text-center">
                  <div class="text-5xl sm:text-6xl font-bold text-blue-600">${record.skor_keseluruhan.toFixed(2)}</div>
                  <p class="text-gray-600 text-sm mt-2">daripada 4.00</p>
                </div>
              </div>
              <div class="flex flex-col justify-center">
                <p class="text-sm text-gray-600 mb-2">Status Pencapaian</p>
                <div class="${statusBadge}" style="text-align: center; font-size: 1.125rem;">${status}</div>
                <div class="mt-4 p-3 bg-gray-50 rounded">
                  <p class="text-xs text-gray-600">Target Minimum:</p>
                  <p class="text-lg font-bold text-gray-900">${targetSkor}</p>
                  <p class="text-xs text-gray-600 mt-2">${achieveTarget ? '‚úì Mencapai target' : '‚úó Tidak mencapai target'}</p>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-white border-2 border-gray-200 rounded-lg p-4 sm:p-6">
            <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-5">Pencapaian Mengikut Standard</p>
            <div class="space-y-5">
              <div><div class="flex items-center justify-between mb-2"><span class="text-sm font-semibold text-gray-900">Standard 1: Kepemimpinan</span><span class="text-lg font-bold text-gray-900">${record.skor_standard_1.toFixed(2)}</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${(record.skor_standard_1 / 4) * 100}%"></div></div></div>
              <div><div class="flex items-center justify-between mb-2"><span class="text-sm font-semibold text-gray-900">Standard 2: Pengurusan Organisasi</span><span class="text-lg font-bold text-gray-900">${record.skor_standard_2.toFixed(2)}</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${(record.skor_standard_2 / 4) * 100}%"></div></div></div>
              <div><div class="flex items-center justify-between mb-2"><span class="text-sm font-semibold text-gray-900">Standard 3: Kurikulum, Kokurikulum & HEM</span><span class="text-lg font-bold text-gray-900">${record.skor_standard_3.toFixed(2)}</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${(record.skor_standard_3 / 4) * 100}%"></div></div></div>
              <div><div class="flex items-center justify-between mb-2"><span class="text-sm font-semibold text-gray-900">Standard 4: Pembelajaran & Pemudahcaraan</span><span class="text-lg font-bold text-gray-900">${record.skor_standard_4.toFixed(2)}</span></div><div class="progress-bar"><div class="progress-fill" style="width: ${(record.skor_standard_4 / 4) * 100}%"></div></div></div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
            <div class="bg-white border-2 border-gray-200 rounded-lg p-4 sm:p-6">
              <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-3">Catatan Umum</p>
              <p class="text-gray-900 text-sm leading-relaxed whitespace-pre-wrap">${record.catatan_umum || 'Tiada catatan.'}</p>
            </div>
            <div class="bg-white border-2 border-gray-200 rounded-lg p-4 sm:p-6">
              <p class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-3">Tindakan Susulan</p>
              <p class="text-gray-900 text-sm leading-relaxed whitespace-pre-wrap">${record.tindakan_susulan || 'Tiada tindakan yang ditetapkan.'}</p>
            </div>
          </div>
        </div>
      `;

      document.getElementById('report-content').innerHTML = summaryHtml;
      document.getElementById('report-modal-title').textContent = `Rumusan Pemantauan - ${record.school_name}`;
      document.getElementById('report-modal').classList.remove('hidden');
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      document.getElementById('toast-message').textContent = message;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
    }

    window.addEventListener('load', initApp);
function exportExcel() {
  if (allRecords.length === 0) {
    showToast("Tiada rekod untuk dieksport.");
    return;
  }

  let table = `
  <table border="1">
    <tr>
      <th>Nama Sekolah</th>
      <th>Kod Sekolah</th>
      <th>Tarikh Penilaian</th>
      <th>Penilai</th>
      <th>Skor Standard 1</th>
      <th>Skor Standard 2</th>
      <th>Skor Standard 3</th>
      <th>Skor Standard 4</th>
      <th>Skor Keseluruhan</th>
      <th>Status</th>
      <th>Catatan</th>
      <th>Tindakan Susulan</th>
    </tr>
  `;

  allRecords.forEach(r => {
    table += `
      <tr>
        <td>${r.school_name}</td>
        <td>${r.school_code}</td>
        <td>${new Date(r.tarikh_penilaian).toLocaleDateString("ms-MY")}</td>
        <td>${r.penilai_ppd}</td>
        <td>${r.skor_standard_1.toFixed(2)}</td>
        <td>${r.skor_standard_2.toFixed(2)}</td>
        <td>${r.skor_standard_3.toFixed(2)}</td>
        <td>${r.skor_standard_4.toFixed(2)}</td>
        <td>${r.skor_keseluruhan.toFixed(2)}</td>
        <td>${getStatus(r.skor_keseluruhan)}</td>
        <td>${r.catatan_umum || ''}</td>
        <td>${r.tindakan_susulan || ''}</td>
      </tr>
    `;
  });

  table += `</table>`;

  const html = `
    <html xmlns:o="urn:schemas-microsoft-com:office:office" 
          xmlns:x="urn:schemas-microsoft-com:office:excel">
    <head>
      <meta charset="UTF-8">
    </head>
    <body>
      ${table}
    </body>
    </html>
  `;

  const blob = new Blob([html], {
    type: "application/vnd.ms-excel;charset=utf-8;"
  });

  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;
  link.download = "Laporan_SKPM_PPD_Kota_Marudu.xls";
  link.click();
}

  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c9fef110661d04c',t:'MTc3MDQzNjMzOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
